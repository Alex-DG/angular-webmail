function _indexOf(a,b){var c=a.indexOf(b);return-1==c?null:c}function _lc(a){return a.toLocaleLowerCase()}function _uc(a){return a.toLocaleUpperCase()}function associate(a,b){return a.reduce(function(a,c,d){return a[b[d]]=c,a},{})}function between_equalto(a,b,c){return a>=b&&c>=a}function def(a,b,c,d){var e=c===!0?Date:DATE_PROTO;return d!==!0&&a in e?e[a]:(Object.defineProperty(e,a,{configurable:!0,enumerable:!1,value:b,writable:!0}),b)}function pad(a,b,c){var d=-1,e=a.toString(c||10);for(b-=e.length;++d<b;)e="0"+e;return e}function pluck(a,b){return a.reduce(function(a,c){return a.push(value(c,b)),a},[])}function sum(a,b){return a+b}function buildParser(a){var b,c,d,e,f,g,h,i=Date.locale.id;if(cache_parse[i][a])return cache_parse[i][a];for(g=a.replace(re_add_nr,NOREPLACE_RB).replace(re_add_enr,NOREPLACE_RE).split(re_split),c=[],b=-1,d=g.length,e={},h=[];++b<d;)f=g[b],f!=NOREPLACE?f.replace(re_compile,function(a,b,d,f){var g,i,j;(j=parser[d])&&(j.k&&(c.push(j.k),j.fn&&(e[j.k]=j.fn)),j.combo&&(i=pluck(j.combo,"k"),g=associate(pluck(j.combo,"fn"),i),c.push.apply(c,i),copy(e,g,!0)),j.re&&h.push(b,j.re,f))}):(h.push(g[++b]),++b);return cache_parse[i][a]=parse.bind(null,new RegExp(h.join("")),c,e)}function parse(a,b,c,d){for(var e=new Date(0,0,1,0,0,0,0),f=-1,g=b.length,h=d.match(a),i=associate(h.slice(1),b);++f<g;)"string"==typeof i[b[f]]&&c[b[f]]&&(i[b[f]]=c[b[f]](i[b[f]],i));return isNaN(i[UNIX])?(parse_setTime(e,i[HOUR],i[MINUTE],i[SECOND],i[MILLISECOND]),parse_setDate(e,i),parse_setTimezoneOffset(e,i[TIMEZONE])):e.setTime(i[UNIX]),e}function parse_setDate(a,b){var c,d,e,f,g=Date.locale,h=-1;if(!date_members.every(Object.prototype.hasOwnProperty.bind(b))){if(isNaN(b[YEAR])&&(b[YEAR]=a.getFullYear()),isNaN(b[MONTH])&&(e=g.isLeapYear(b[YEAR])?1:0,f=g.ordinal_day_count[e],d=f.length,b[MONTH]=0,b[WEEK]&&!b[DAYYEAR]&&(c=b[DAYWEEK],c=isNaN(c)?0:c?c:7,b[DAYYEAR]=7*b[WEEK]-(4-c)),!isNaN(b[DAYYEAR])))for(b[DAYYEAR]>f[f.length-1]&&(b[DAYYEAR]-=f[f.length-1],++b[YEAR]);++h<d;)if(between_equalto(b[DAYYEAR],f[h],f[h+1])){b[MONTH]=h,b[DAY]=0==f[h]?b[DAYYEAR]:b[DAYYEAR]-f[h];break}isNaN(b[DAY])&&(b[DAY]=1),a.setYear(b[YEAR]),a.setMonth(b[MONTH]),a.setDate(b[DAY])}}function parse_setTime(a,b,c,d,e){a.setHours(b||0),a.setMinutes(c||0),a.setSeconds(d||0),a.setMilliseconds(e||0)}function parse_setTimezoneOffset(a,b){between_equalto(b,-43200,50400)&&a.adjust(Date.SECOND,60*-a.getTimezoneOffset()-b)}function diff_eval(a,b,c,d){var e;return a.__ms__?a.excl[b[0]]?d[c+1]&&!a.excl[d[c+1][0]]||!(b=d[c-1])?a:(e=a.__ms__/b[1],a.__ms__=Math.round(e)*b[1]+a.__ms__/d[c][1]%1*d[c][1],diff_eval(a,b,c-1,[])):(a.__ms__>=b[1]&&(e=a.__ms__/b[1],b[0]in a.val?(e=Math.floor(e),a.__ms__-=e*b[1],a.val[b[0]]+=e):(a.__ms__=e%1*b[1],a.val[b[0]]=Math.floor(e))),a):a}function diff_get(a,b){var c=time_map.reduce(diff_eval,{__ms__:a,excl:b,val:Object.create(null)}).val;return c.value=a,c}function diff_get_exclusions(a){var b=Object.create(null),c=!0;if(a)switch(type.native(a)){case"object":c=!1;break;case"string":a=a.split(" ");case"array":a=a.reduce(diff_excl,b),c=!!iter.len(b)}return time_props.map(function(a){a in this||(this[a]=!c)},b),b}function diff_excl(a,b){var c=(b=String(b).toLowerCase()).substring(1);switch(b.charAt(0)){case"-":a[c]=!0;break;case"+":a[c]=!1;break;case">":time_map.map(diff_excl_iter,{excl:a,prop:c,val:!0});break;case"<":time_map.slice().reverse().map(diff_excl_iter,{excl:a,prop:c,val:!1});break;default:a[b]=!1}return a}function diff_excl_iter(a){a[0]===this.prop&&(this.SET_VALID=!0),this.SET_VALID&&(this.excl[a[0]]=this.val)}function _24hrTime(a,b){return(a=Number(a))<12&&_lc(b.ampm)==_lc(Date.locale.PM)?a+=12:a}function _adjust_toobj(a){return adjust_order.reduce(function(b,c,d){var e=parseFloat(a[d]);return isNaN(e)||0===e||(b[c]=e),b},Object.create(null))}function _dayOffset(a){return Math.floor((a-a.getISOFirstMondayOfYear(a))/MS_DAY)}function _hours(a){return a.getHours()+(a.isDST()?1:0)}function _timezoneOffset(a){"Z"==a&&(a="0000");var b=!!a.indexOf("-"),c=a.match(re_tz_off),d=3600*(Number(c[1])+c[2]/60);return b?d:-d}function _weekOffset(a){return Math.floor(Math.abs(_dayOffset(a)/7))}function _zeroIndexedInt(a,b){return isNaN(b)?Number(a)-1:b==a?0:Number(b)}function buildTemplate(a){var b,c,d,e,f,g,h=Date.locale.id;if(cache_format[h][a])return cache_format[h][a];for(b=["	var out=[];"],f=a.replace(re_add_nr,NOREPLACE_RB).replace(re_add_enr,NOREPLACE_RE).split(re_split),g=/^[^A-Za-z]*$/g,c=-1,d=f.length;++c<d;)e=f[c],e==NOREPLACE?(b.push(tplOut(f[++c])),++c):g.test(e)?b.push(tplOut(e)):b.push(compileTplStr(e));return b.push('return out.join( "" );\n	//@ sourceURL=Date/format/'+h+"/"+a),cache_format[h][a]=new Function("filter","date",b.join("\n\n	"))}function compileTplStr(a){return a.replace(re_compile,function(a,b,c,d){return tplOut(b+"', filter."+c+"( date ), '"+d)})}function tplOut(a){return"out.push( '"+a+"' );"}function lexicalize_approx(a){return a.join(" ")}function lexicalize_exact(a,b){var c=a.pop();return(a.length?a.join(this.delim)+" "+this.and+" "+c:c)+" "+this[b.tense<1?"ago":"from_now"]}function localize_filters(a){var b={d:function(a){return pad(a.getDate(),2)},D:function(b){return a.days[b.getDay()].substring(0,3)},j:function(a){return a.getDate()},l:function(b){return a.days[b.getDay()]},N:function(a){return DATE_PROTO.getISODay.call(a)},S:function(b){return a.getOrdinal(b.getDate())},w:function(a){return a.getDay()},z:function(a){return DATE_PROTO.getDayOfYear.call(a)},W:function(a){return a.getISOWeek()},F:function(b){return a.months[b.getMonth()]},m:function(a){return pad(a.getMonth()+1,2)},M:function(b){return a.months[b.getMonth()].substring(0,3)},n:function(a){return a.getMonth()+1},t:function(b){return a.setLeapYear(b),a.day_count[b.getMonth()]},L:function(a){return DATE_PROTO.isLeapYear.call(a)?1:0},o:function(a){var b=a.getMonth(),c=DATE_PROTO.getISOWeek.call(a);return a.getFullYear()+(1==c&&b>0?1:c>=52&&11>b?-1:0)},Y:function(a){return a.getFullYear()},y:function(a){return String(a.getFullYear()).substring(2,4)},a:function(b){return _lc(b.getHours()<12?a.AM:a.PM)},A:function(b){return _uc(b.getHours()<12?a.AM:a.PM)},g:function(a){return a.getHours()%12||12},G:function(a){return a.getHours()},h:function(a){return pad(filter.g(a),2)},H:function(a){return pad(filter.G(a),2)},i:function(a){return pad(a.getMinutes(),2)},s:function(a){return pad(a.getSeconds(),2)},u:function(a){return pad(a.getMilliseconds(),3)},O:function(a){return DATE_PROTO.getGMTOffset.call(a)},P:function(a){return DATE_PROTO.getGMTOffset.call(a,!0)},T:function(a){return DATE_PROTO.timezone.call(a)},Z:function(a){return-60*DATE_PROTO.getTimezoneOffset.call(a)},c:function(a){return DATE_PROTO.format.call(a,formats.ISO_8601)},r:function(a){return DATE_PROTO.format.call(a,formats.RFC_2822)},U:function(a){return a.getTime()},e:function(a){return DATE_PROTO.lexicalize.call(a,"exact")},x:function(a){return DATE_PROTO.lexicalize.call(a,"approx")}};return filter_chars=Object.keys(b).sort().join(""),re_compile=new RegExp("([^"+filter_chars+"]*)(["+filter_chars+"])([^"+filter_chars+"]*)","g"),def("filters",filter=b,!0),b}function localize_formats(a){var b=copy({ISO_8601:"Y-m-d<T>H:i:s.u<Z>",ISO_8601_SHORT:"Y-m-d",RFC_850:"l, d-M-y H:i:s T",RFC_2822:"D, d M Y H:i:s O",sortable:"Y-m-d H:i:sO"},a.formats);return b.atom=b.ISO_8601,b.cookie=b.RFC_850,b.rss=b.RFC_2822,def("formats",formats=b,!0),b}function localize_parsers(a){var b={d:{k:DAY,fn:Number,re:re_d2},D:{k:DAYWEEK,fn:_indexOf.bind(null,a.days_short),re:"("+a.days_short.join("|")+")"},j:{k:DAY,fn:Number,re:re_d1_2},l:{k:DAYWEEK,fn:_indexOf.bind(null,a.days),re:"("+a.days.join("|")+")"},N:{k:DAYWEEK,fn:_zeroIndexedInt.bind(null,7),re:"([1-7])"},S:{re:"(?:"+a.ordinal.join("|")+")"},w:{k:DAYWEEK,fn:Number,re:"([0-6])"},z:{k:DAYYEAR,fn:Number,re:"([0-9]{1,3})"},W:{k:WEEK,fn:Number,re:re_d1_2},F:{k:MONTH,fn:_indexOf.bind(null,a.months),re:"("+a.months.join("|")+")"},m:{k:MONTH,fn:_zeroIndexedInt,re:re_d2},M:{k:MONTH,fn:_indexOf.bind(null,a.months_short),re:"("+a.months_short.join("|")+")"},n:{k:MONTH,fn:_zeroIndexedInt,re:re_d1_2},t:{re:"[0-9]{2}"},L:{re:"(?:0|1)"},o:{k:YEAR,fn:Number,re:re_d4},Y:{k:YEAR,fn:Number,re:re_d4},y:{k:YEAR,fn:function(a){return a=Number(a),a+=30>a?2e3:1900},re:re_d2},a:{k:AMPM,fn:iter.k,re:re_ampm},A:{k:AMPM,fn:_lc,re:_uc(re_ampm)},g:{k:HOUR,fn:_24hrTime,re:re_d1_2},G:{k:HOUR,fn:Number,re:re_d1_2},h:{k:HOUR,fn:_24hrTime,re:re_d2},H:{k:HOUR,fn:Number,re:re_d2},i:{k:MINUTE,fn:Number,re:re_d2},s:{k:SECOND,fn:Number,re:re_d2},u:{k:MILLISECOND,fn:Number,re:"([0-9]{1,})"},O:{k:TIMEZONE,fn:_timezoneOffset,re:"([\\+-][0-9]{4})"},P:{k:TIMEZONE,fn:_timezoneOffset,re:"([\\+-][0-9]{2}:[0-9]{2})"},T:{re:"[A-Z]{1,4}"},Z:{k:TIMEZONE,fn:_timezoneOffset,re:"(Z|[\\+-]?[0-9]{2}:?[0-9]{2})"},U:{k:UNIX,fn:Number,re:"(-?[0-9]{1,})"}};return b.c={combo:[b.Y,b.m,b.d,b.H,b.i,b.s,b.u,b.P],re:[b.Y.re,"-",b.m.re,"-",b.d.re,"T",b.H.re,":",b.i.re,":",b.s.re,"(?:\\.",b.u.re,"){0,1}",b.Z.re,"{0,1}"].join("")},b.r={combo:[b.D,b.d,b.M,b.Y,b.H,b.i,b.s,b.O],re:[b.D.re,", ",b.d.re," ",b.M.re," ",b.Y.re," ",b.H.re,":",b.i.re,":",b.s.re," ",b.O.re].join("")},def("parsers",parser=b,!0),b}var copy=require("useful-copy"),iter=require("useful-iter"),type=require("useful-type"),value=require("useful-value"),UNDEF,DATE_PROTO=Date.prototype,DAY_OFFSETS=[9,1,0,-1,-2,4,3],MS_DAY=def("MS_DAY",864e5,!0),MS_HOUR=def("MS_HOUR",36e5,!0),MS_MINUTE=def("MS_MINUTE",6e4,!0),MS_MONTH=def("MS_MONTH",2592e6,!0),MS_SECOND=def("MS_SECOND",1e3,!0),MS_WEEK=def("MS_WEEK",6048e5,!0),MS_YEAR=def("MS_YEAR",31536e6,!0),AMPM="ampm",DAY=def("DAY","day",!0),DAYWEEK="dayweek",DAYYEAR="dayyear",HOUR="hour",MILLISECOND=def("MILLISECOND","ms",!0),MINUTE="minute",MONTH=def("MONTH","month",!0),SECOND="second",TIMEZONE="timezone",UNIX="unix",WEEK=def("WEEK","week",!0),YEAR=def("YEAR","year",!0),NOREPLACE="NOREPLACE",NOREPLACE_RB="<"+NOREPLACE+"<",NOREPLACE_RE=">END"+NOREPLACE+">",adjust_by={day:["getDate","setDate"],hr:["getHours","setHours"],min:["getMinutes","setMinutes"],month:["getMonth","setMonth"],ms:["getMilliseconds","setMilliseconds"],sec:["getSeconds","setSeconds"],week:["getWeek","setWeek"],year:["getFullYear","setFullYear"]},adjust_order=[YEAR,MONTH,WEEK,DAY,"hr",MINUTE.substring(0,3),SECOND.substring(0,3),MILLISECOND],cache_format=Object.create(null),cache_parse=Object.create(null),date_members=[DAY,DAYWEEK,DAYYEAR,MONTH,WEEK,YEAR],filter,filter_chars,formats,lexicon=def("lexicon",Object.create(null),!0),locales=Object.create(null),m,parser,re_ampm="(am|pm)",re_add_enr=/>/g,re_add_nr=/</g,re_compile,re_d1_2="([0-9]{1,2})",re_d2="([0-9]{2})",re_d4="([0-9]{4})",re_space=/\s{2,}/g,re_split=/[<>]/,re_tz=/[^\(]*\(([^\)]+)\)/g,re_tz_abbr=/[^A-Z]+/g,re_tz_off=/[\+-]?([0-9]{2}):?([0-9]{2})/,time_map=def("time_map",[[YEAR+"s",MS_YEAR],[MONTH+"s",MS_MONTH],[WEEK+"s",MS_WEEK],[DAY+"s",MS_DAY],[HOUR+"s",MS_HOUR],[MINUTE+"s",MS_MINUTE],[SECOND+"s",MS_SECOND],[MILLISECOND,1]],!0),time_props=def("time_props",pluck(time_map,0),!0);def("coerce",function(a,b){return buildParser(b)(a)},!0),def("diff",function a(b,c){switch(type.native(b)){case"number":case"string":if(!Date.valid(new Date(b))){c||(c=b),b=Date.now();break}b=new Date(b);case"array":case"object":c=b,b=Date.now();break;case"date":if(Date.valid(new Date(+b)))break;default:b=Date.now()}var a,d=+b-+this,e=0>d?1:d>0?-1:0;return e?a=diff_get(Math.abs(d),diff_get_exclusions(c)):(a=Object.create(null),a.value=0),a.tense=e,a}),def("diffKeys",function(a){return a=copy(a),iter.remove(a,"tense","value"),pluck(Object.keys(a).map(function(a){return[time_props.indexOf(a),a]}).sort(function(a,b){return a=a[0],b=b[0],a>b?1:-1}),1)},!0),def("adjust",function(a,b){var c,d,e,f,g,h,i=this;switch(type.native(a)){case"number":a=Array.prototype.slice.call(arguments);case"array":a=_adjust_toobj(a);case"object":for(g=Object.keys(a),e=-1,f=g.length;++e<f;)Object.prototype.hasOwnProperty.call(a,g[e])&&i.adjust(g[e],a[g[e]]);break;case"string":d=adjust_by[a.toLowerCase()],d&&0!==b&&(Date.locale.setLeapYear(i),d==adjust_by.month&&(c=i.getDate(),28>c||i.setDate(Math.min(c,i.getFirstOfTheMonth().adjust(Date.MONTH,b).getLastOfTheMonth().getDate()))),d!=adjust_by.week||(h=i.getDay()),i[d[1]](i[d[0]]()+b),!h||i.setDate(i.getDate()+h))}return i}),def("between",function(a,b){return+this>=+a&&+b>=+this}),def("clearTime",function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this}),def("clone",function(){return new Date(this.getTime())}),def("getDayOfYear",function(){var a=Date.locale;return a.setLeapYear(this),a.day_count.slice(0,this.getMonth()).reduce(sum,0)+this.getDate()-1}),def("getFirstOfTheMonth",function(){return new Date(this.getFullYear(),this.getMonth(),1)}),def("getGMTOffset",function(a){var b=this.getTimezoneOffset();return[b>0?"-":"+",pad(Math.floor(Math.abs(b)/60),2),a?":":"",pad(Math.abs(b%60),2)].join("")}),def("getISODay",function(){return this.getDay()||7}),def("getISODaysInYear",function(){return Math.ceil((new Date(this.getFullYear()+1,0,1).getISOFirstMondayOfYear()-this.getISOFirstMondayOfYear())/MS_DAY)}),def("getISOFirstMondayOfYear",function(){var a=this.getFullYear();return new Date(a,0,DAY_OFFSETS[new Date(a,0,1).getDay()])}),def("getISOWeek",function(){var a,b=this.getFullYear();return this>=new Date(b+1,0,1).getISOFirstMondayOfYear()?1:(a=Math.floor((this.getDayOfYear()-this.getISODay()+10)/7),0==a?new Date(b-1,0,1).getISOWeeksInYear()-_weekOffset(this):a)}),def("getISOWeeksInYear",function(){return Math.round((new Date(this.getFullYear()+1,0,1).getISOFirstMondayOfYear()-this.getISOFirstMondayOfYear())/MS_WEEK)}),def("getLastOfTheMonth",function(){var a=Date.locale,b=this.getMonth();return a.setLeapYear(this),new Date(this.getFullYear(),b,a.day_count[b])}),def("getWeek",function(){return Math.floor(this.getDayOfYear()/7)}),def("isDST",function(){return new Date(this.getFullYear(),0,1).getTimezoneOffset()!=this.getTimezoneOffset()}),def("isLeapYear",function(){return Date.locale.isLeapYear(this.getFullYear())}),def("setWeek",function(a){return this.setMonth(0),this.setDate(1),this.adjust(Date.DAY,7*a).getTime()}),def("timezone",function(){var a=this.toString().split(" ");return a.splice(4,a.length).join(" ").replace(re_tz,"$1").replace(re_tz_abbr,"")}),def("valid",function(a){return"date"==type.native(a)&&!isNaN(+a)},!0),def("valid",function(){return Date.valid(this)}),def("format",function(a){return buildTemplate(a)(filter,this)}),def("lexicalize",function(a,b){Date.valid(a)||(Date.valid(new Date(a))?a=new Date(a):(b=a,a=Date.now()));var c=Date.locale.lexicon;return"function"!=typeof lexicon[b=String(b).toLowerCase()]&&(b=c.DEFAULT),+a-+this?lexicon[b].call(c,this,a).replace(re_space," "):c.just_now}),lexicon.approx=function(a,b){var c,d,e,f,g,h,i,j=this.a,k=a.diff(b),l=Date.diffKeys(k),m=Date.time_map,n=this.time_units;if(k.value<Date.MS_MINUTE)return this.just_now;switch(l[0]){case"years":e=0;break;case"months":e=1;break;case"weeks":e=2;break;case"days":k.days<2&&(h=a.format("l")===b.format("l"),i=h||"hours"!=l[1]||k.hours<25),e=3;break;case"hours":h=a.format("l")===b.format("l"),i=k.hours/24>=.75,j=this.an,e=4;break;case"minutes":e=5}if(d=(k.value-m[e][1]*k[l[0]])/m[e][1],i)return h?this.today:k.tense>0?this.tomorrow:this.yesterday;if(f=[],g=k.tense>0?this.from_now:this.ago,.1>d)switch(l[0]){case"years":case"months":case"weeks":if(1===k[l[0]]){f.push(k.tense<1?this.last:this.next,n[e][0]);break}default:!d||f.push(this.about),f.push(k[l[0]],n[e][k[l[0]]>1?1:0],g)}else.74>d?.24>d?c=this.just_over:(c=d>.24&&.4>d?this.almost:this.about,f.push(this.and,this.a,this.half)):f.push(this.almost,k[l[0]]+1,n[e][1],g);return c&&(f.push(n[e][k[l[0]]>1||f.length?1:0],g),f.unshift(c,k[l[0]])),"function"==typeof this.approx?this.approx.call(this,f,k):lexicalize_approx.call(this,f,k)},lexicon.exact=function(a,b){var c,d=a.diff(b),e=this.time_units;return c=Date.time_map.reduce(function(a,b,c){var f=d[b[0]];return!f||!e[c]||a.push(f+" "+e[c][f>1?1:0]),a},[]),c.length?"function"==typeof this.exact?this.exact.call(this,c,d):lexicalize_exact.call(this,c,d):this.just_now},def("localize",function(a){switch(type.native(a)){case"object":if(a.id){locales[a.id]=a;break}case"string":if(a in locales){a=locales[a];break}default:a=null}return"object"==type.native(a)&&(def("locale",a,!0,!0),def("getOrdinal",a.getOrdinal,!0,!0),def("isLeapYear",a.isLeapYear,!0,!0),def("setLeapYear",a.setLeapYear,!0,!0),a.id in cache_format||(cache_format[a.id]=Object.create(null)),a.id in cache_parse||(cache_parse[a.id]=Object.create(null)),filter=localize_filters(a),formats=localize_formats(a),parser=localize_parsers(a)),Date},!0),module.exports=Date,def("HOUR","hr",!0),def("MINUTE",MINUTE.substring(0,3),!0),def("MILLISECOND",MILLISECOND,!0),def("SECOND",SECOND.substring(0,3),!0),module.exports=Date;